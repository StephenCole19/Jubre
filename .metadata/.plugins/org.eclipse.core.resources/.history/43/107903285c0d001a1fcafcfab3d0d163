import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.event.ActionEvent;
import javafx.geometry.Pos;
import javafx.scene.Scene;
import javafx.scene.control.Button;
import javafx.scene.control.Label;
import javafx.scene.control.ListCell;
import javafx.scene.control.ListView;
import javafx.scene.control.TableColumn;
import javafx.scene.control.TableView;
import javafx.scene.layout.*;
import javafx.scene.paint.Color;
import javafx.stage.Stage;
import javafx.util.Callback;

/**
 * This class handles all of the GUI aspects of the viewMessages use case
 * @author Brennan Couturier, 3638808
 *
 */
public class viewMessagesUI 
{
	
	//Non-javafx variables
	//-------------------------------------------------------------------------------
	
	private viewMessagesControl vmc;
	
	private int userId;
	
	
	
	
	//-------------------------------------------------------------------------------
	
	//Javafx variables
	//-------------------------------------------------------------------------------
	/**
	 * This button will display all of the messages the current user has sent
	 */
	private Button btnSentItems;
	/**
	 * This button will display all of the messages the current user has recieved
	 */
	private Button btnRecievedItems;
	
	/**
	 * This button will open the postMessageUI and allow the user to post a message
	 */
	private Button btnNewMessage;
	
	/**
	 * Used to neatly format the screen
	 */
	private GridPane viewMessagesPane;
	
	/**
	 * This scene is used to display a list of messages as well as the information of a selected one
	 */
	private Scene scViewMessages;
	
	/**
	 * This is the table listing all the messages a user has received or sent, depending on which button is pressed
	 * Received messages are displayed by default
	 */
	private TableView messagesTable;
	
	/**
	 * This label will display the textual aspect of a selected message
	 */
	private Label lblTxtMessage;
	
	/**
	 * This label will display "From" if the user is looking at received messages, and "To" if they are looking at sent messages
	 */
	private Label lblFromTo;
	
	/**
	 * This label will display the name of the user who sent the message, or the name of the user who received the message, depending on what button is pressed
	 */
	private Label lblName;
	
	/**
	 * This label will display a Timestamp of when the message was received/sent.
	 */
	private Label lblDate;

	//-------------------------------------------------------------------------------
	
	public viewMessagesUI()
	{
		vmc = new viewMessagesControl();
	}
	
	private void initViewMessagesComponents()
	{
		initReceivedMessagesTable();

		lblTxtMessage = new Label("");
		lblTxtMessage.setPrefSize(300, 500);
		lblTxtMessage.setStyle("-fx-background-color: WHITE");
		lblTxtMessage.setBorder(new Border(new BorderStroke(Color.BLACK, BorderStrokeStyle.SOLID, null, new BorderWidths(1))));
		
		lblFromTo = new Label("From");
		
		
		lblName = new Label("");
		
		
		lblDate = new Label("");
		
		
		btnSentItems = new Button("Sent Items");
		btnSentItems.setOnAction(this::processSentItemsButtonPress);
		btnSentItems.setPrefWidth(150);
		
		btnRecievedItems = new Button("Inbox");
		btnRecievedItems.setOnAction(this::processRecievedItemsButtonPress);
		btnRecievedItems.setPrefWidth(150);
		
		btnNewMessage = new Button("New Message");
		btnNewMessage.setOnAction(this::processNewMessageButtonPress);
		btnNewMessage.setPrefWidth(150);
		
		viewMessagesPane = new GridPane();
		viewMessagesPane.setHgap(20);
		viewMessagesPane.setVgap(5);
		viewMessagesPane.setAlignment(Pos.CENTER);
	}

	public Scene initViewMessagesScene()
	{
		initViewMessagesComponents();
		
		viewMessagesPane.add(lblTxtMessage, 2, 1);
		viewMessagesPane.add(btnSentItems, 0, 4);
		viewMessagesPane.add(btnRecievedItems, 0, 3);
		viewMessagesPane.add(btnNewMessage, 0, 1);
		viewMessagesPane.add(messagesTable, 1, 1);
		
		scViewMessages = new Scene(viewMessagesPane, 900, 600);
		return scViewMessages;
		
	}
	
	public void displayViewMessages(Stage stg)
	{
		stg.setScene(initViewMessagesScene());
		stg.show();
	}
	
	public void displayMessagesRecieved(int userId) 
	{
		ArrayList<Message> messages = new ArrayList<Message>();
		
		try
		{
			messages = vmc.getMessagesReceived(userId);
		}
		catch (SQLException e)
		{
			System.err.println(e.getMessage());
		}
		
		if (messages.isEmpty())
		{
			System.out.println("No messages");
		}
		else
		{
			System.out.println("Messages");
			for (int i = 0; i < messages.size(); i++)
			{
				int messageId = messages.get(i).getMessageId();
				System.out.println(i + ": " + messageId);
			}
		}
	}
	
	public void displayMessagesSent(int userId)
	{
		ArrayList<Message> messages = new ArrayList<Message>();
		
		try
		{
			messages = vmc.getMessagesSent(userId);
		}
		catch (SQLException e)
		{
			System.err.println(e.getMessage());
		}
		
		if (messages.isEmpty())
		{
			System.out.println("No messages");
		}
		else
		{
			System.out.println("Messages");
			for (int i = 0; i < messages.size(); i++)
			{
				int messageId = messages.get(i).getMessageId();
				System.out.println(i + ": " + messageId);
			}
		}
	}
	
	
	private void processSentItemsButtonPress(ActionEvent event)
	{
		//Populate table with list of messages the user sent
	}
	
	private void processRecievedItemsButtonPress(ActionEvent event)
	{
		//populate table with list of messages the user received
	}
	
	private void processNewMessageButtonPress(ActionEvent event)
	{
		postMessageUI pmu = new postMessageUI();
		viewMessagesGUITest vmgt = new viewMessagesGUITest();
		
		pmu.displayCreateMessageForm(vmgt.getStage());
	}

	public void resetToViewMessagesUI() 
	{
		viewMessagesGUITest vmgt = new viewMessagesGUITest();
		displayViewMessages(vmgt.getStage());
	}
	
	private void initReceivedMessagesTable()
	{
		messagesTable = new TableView();
		messagesTable.setEditable(false);
		messagesTable.setPrefSize(200, 500);
	}
}










